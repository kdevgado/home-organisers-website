---
const {
  title = "Professional Home Organising - Shepparton & Goulburn Valley",
  description = "Warm, non-judgemental decluttering and home organising for Shepparton and the Goulburn Valley. Simple systems, local care, and lasting calm.",
  canonical,
} = Astro.props;
const showCTA = Astro.url.pathname !== "/contact";
---

<!doctype html>
<html lang="en-AU">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />

    <!-- Brand typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Favicons -->
    <link
      rel="icon"
      href={`${import.meta.env.BASE_URL}images/logo.jpg`}
      type="image/jpeg"
      sizes="32x32"
    />
    <link
      rel="apple-touch-icon"
      href={`${import.meta.env.BASE_URL}images/logo_transparent.png`}
    />
    <meta name="theme-color" content="#ffffff" />

    <!-- Global CSS -->
    <link
      rel="stylesheet"
      href={`${import.meta.env.BASE_URL}styles/global.css`}
    />

    {canonical && <link rel="canonical" href={canonical} />}
    <title>{title}</title>
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="container header-inner">
        <a href="/" class="logo">
          <img
            src={`${import.meta.env.BASE_URL}images/logo_transparent.png`}
            alt="Shepparton Home Organising logo"
            class="logo-img"
          />
        </a>

        <!-- Desktop nav -->
        <nav class="nav nav-desktop">
          <a href="/" class="home-btn">Home</a>
          <div class="dropdown">
            <a href="/services" class="nav-parent">HomeOrg Services</a>
            <div class="dropdown-menu">
              <a href="/services/home-decluttering">Home Decluttering</a>
              <a href="/services/practical-organising">Practical Organising</a>
              <a href="/services/homeshare-coliving">Homeshare and Co-living</a>
              <a href="/services/moving-houses"
                >Moving Houses &amp; Setting Up</a
              >
              <a href="/services/staging">Staging to Sell/Lease</a>
            </div>
          </div>
          <a href="/about">About</a>
          <a href="/clutterbug-styles">Clutterbug Styles</a>
          <a href="/before-after">Gallery</a>

          <a class="btn" href="/contact">Book a free chat</a>
        </nav>

        <!-- Hamburger (mobile only) -->
        <button
          class="menu-toggle"
          aria-controls="mobile-nav"
          aria-expanded="false"
          aria-label="Open menu"
        >
          <span class="menu-bars" aria-hidden="true"></span>
        </button>
      </div>
    </header>

    <!-- Main -->
    <main class="site-main">
      <slot />
    </main>

    <!-- Sticky CTA (hidden on contact page) -->
    {showCTA && (
      <a class="floating-cta" href="/contact">
        Book a free 30-min chat
      </a>
    )}

    <!-- Footer -->
    <footer class="site-footer">
      <div class="container">
        <p>
          <strong>Based in Shepparton, VIC</strong> — proudly serving the Goulburn
          Valley and the shires of Mitchell, Murrindindi, Moira and Strathbogie.
        </p>
        <p>Respect • Simplicity • Discretion • Sustainability</p>
        <p class="small">
          © {new Date().getFullYear()} Shepparton Home Organising
        </p>
      </div>

      <!-- Footer nav -->
      <nav class="footer-nav">
        <a href="/">Home</a>
        <a href="/services">Services</a>
        <a href="/about">About</a>
        <a href="/clutterbug-styles">Clutterbug Styles</a>
        <a href="/before-after">Gallery</a>
        <a href="/contact">Contact</a>
      </nav>

      <section class="fb-section">
        <h2 class="fb-heading">Follow us on Facebook</h2>

        <div class="fb-wrap">
          <!-- Facebook plugin -->
          <div id="fb-plugin-anchor">
            <div
              class="fb-page"
              data-href="https://www.facebook.com/HomeOrgAustralia"
              data-tabs="timeline"
              data-width="380"
              data-height="420"
              data-small-header="false"
              data-adapt-container-width="true"
              data-hide-cover="false"
              data-show-facepile="true"
            >
              <blockquote
                cite="https://www.facebook.com/HomeOrgAustralia"
                class="fb-xfbml-parse-ignore"
              >
                <a
                  href="https://www.facebook.com/HomeOrgAustralia"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Home Organisers Australia on Facebook
                </a>
              </blockquote>
            </div>
          </div>

          <!-- Questions / Email block -->
          <div class="footer-questions">
            <div class="q">Questions?</div>
            <a class="email" href="mailto:roweedelgado@homeorg.com.au">
              <span class="label">Email:</span> roweedelgado@homeorg.com.au</a
            >
          </div>
        </div>
      </section>
    </footer>

    <!-- ⬇️ IMPORTANT: overlay + drawer live directly under <body>, not inside <header> -->
    <div class="mobile-overlay" data-close></div>

    <nav id="mobile-nav" class="nav-mobile" aria-hidden="true">
      <div class="mobile-header">
        <span class="mobile-title">Menu</span>
        <button class="menu-close" aria-label="Close menu" data-close>
          <span class="menu-cross" aria-hidden="true"></span>
        </button>
      </div>

      <ul class="mobile-list" role="list">
        <li class="mobile-item"><a href="/">Home</a></li>
        <li class="mobile-item has-sub">
          <button
            class="sub-toggle"
            aria-expanded="false"
            aria-controls="sub-services"
          >
            Services
          </button>
          <ul id="sub-services" class="sub-list" role="list" hidden>
            <li class="sub-view-all">
              <a href="/services">View All Services</a>
            </li>
            <li><a href="/services/home-decluttering">Home Decluttering</a></li>
            <li>
              <a href="/services/practical-organising">Practical Organising</a>
            </li>
            <li>
              <a href="/services/homeshare-coliving"
                >Homeshare &amp; Co-living</a
              >
            </li>
            <li>
              <a href="/services/moving-houses"
                >Moving Houses &amp; Setting Up</a
              >
            </li>
            <li>
              <a href="/services/staging">Staging to Sell/Lease</a>
            </li>
          </ul>
        </li>
        <li class="mobile-item">
          <a href="/clutterbug-styles">Clutterbug Styles</a>
        </li>
        <li class="mobile-item"><a href="/before-after">Gallery</a></li>
        <li class="mobile-item"><a href="/about">About</a></li>
        <li class="mobile-item cta">
          <a class="btn" href="/contact">Book a free chat</a>
        </li>
        <!-- Facebook icon button beside Home -->
        <a
          href="https://www.facebook.com/HomeOrgAustralia"
          class="social-btn fb"
          aria-label="Visit us on Facebook"
          target="_blank"
          rel="noopener noreferrer"
        >
          <!-- inline SVG for crisp icon -->
          <svg class="icon-fb" viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M22 12.06C22 6.5 17.52 2 12 2S2 6.5 2 12.06c0 5 3.66 9.15 8.44 9.94v-7.03H7.9v-2.9h2.54V9.41c0-2.5 1.5-3.89 3.8-3.89 1.1 0 2.25.2 2.25.2v2.47h-1.27c-1.25 0-1.64.78-1.64 1.58v1.9h2.79l-.45 2.9h-2.34V22c4.78-.79 8.44-4.94 8.44-9.94Z"
            ></path>
          </svg>
        </a>
      </ul>
    </nav>

    <!-- Header effect on scroll -->
    <script is:inline>
      const header = document.querySelector(".site-header");
      const onScroll = () =>
        header.classList.toggle("scrolled", window.scrollY > 10);
      onScroll();
      addEventListener("scroll", onScroll, { passive: true });
    </script>

    <!-- Mobile menu interactions -->
    <script is:inline>
      (function () {
        const root = document.documentElement;
        const body = document.body;
        const drawer = document.getElementById("mobile-nav");
        const openBtn = document.querySelector(".menu-toggle");
        const overlay = document.querySelector(".mobile-overlay");
        const closeBtns = document.querySelectorAll("[data-close]");
        const subToggles = drawer.querySelectorAll(".sub-toggle");
        let lastFocused;

        function openMenu() {
          lastFocused = document.activeElement;
          drawer.classList.add("open");
          overlay.classList.add("show");
          drawer.setAttribute("aria-hidden", "false");
          openBtn.setAttribute("aria-expanded", "true");
          body.style.overflow = "hidden";
          drawer.querySelector(".mobile-header .menu-close").focus();
        }

        function closeMenu() {
          drawer.classList.remove("open");
          overlay.classList.remove("show");
          drawer.setAttribute("aria-hidden", "true");
          openBtn.setAttribute("aria-expanded", "false");
          body.style.overflow = "";
          if (lastFocused) lastFocused.focus();
        }

        openBtn?.addEventListener("click", openMenu);
        closeBtns.forEach((btn) => btn.addEventListener("click", closeMenu));
        overlay?.addEventListener("click", closeMenu);
        window.addEventListener(
          "keydown",
          (e) => {
            if (e.key === "Escape" && drawer.classList.contains("open"))
              closeMenu();
          },
          { passive: true }
        );
        drawer.addEventListener("click", (e) => {
          const a = e.target.closest("a");
          if (a) closeMenu();
        });

        // Accordion
        subToggles.forEach((btn) => {
          btn.addEventListener("click", () => {
            const expanded = btn.getAttribute("aria-expanded") === "true";
            const target = document.getElementById(
              btn.getAttribute("aria-controls")
            );
            btn.setAttribute("aria-expanded", String(!expanded));
            if (expanded) {
              target.hidden = true;
              target.style.maxHeight = "";
            } else {
              target.hidden = false;
              target.style.maxHeight = target.scrollHeight + "px";
            }
          });
        });

        // Reduce-motion preference
        const mq = window.matchMedia("(prefers-reduced-motion: reduce)");
        if (mq.matches) root.classList.add("reduce-motion");
      })();
    </script>

    <script is:inline>
      (function () {
        let sdkLoaded = false;

        function loadFacebookSDK() {
          if (sdkLoaded) return;
          sdkLoaded = true;

          // Facebook root element
          const fbRoot = document.createElement("div");
          fbRoot.id = "fb-root";
          document.body.prepend(fbRoot);

          // Load the SDK script
          const js = document.createElement("script");
          js.async = true;
          js.defer = true;
          js.crossOrigin = "anonymous";
          js.src =
            "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v21.0";
          document.body.appendChild(js);
        }

        // 1) Lazy-load on viewport proximity
        const anchor = document.getElementById("fb-plugin-anchor");
        if ("IntersectionObserver" in window && anchor) {
          const io = new IntersectionObserver(
            (entries) => {
              if (entries.some((e) => e.isIntersecting)) {
                loadFacebookSDK();
                io.disconnect();
              }
            },
            { rootMargin: "200px" }
          );
          io.observe(anchor);
        }

        // 2) Also load if user clicks a Facebook link anywhere
        document.addEventListener(
          "click",
          (e) => {
            const a = e.target.closest("a");
            if (!a) return;
            if (/facebook\.com\/HomeOrgAustralia/i.test(a.href)) {
              loadFacebookSDK();
            }
          },
          { passive: true }
        );
      })();
    </script>
  </body>
</html>
