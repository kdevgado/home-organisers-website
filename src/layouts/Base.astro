---
const {
  title = "Professional Home Organising - Shepparton & Goulburn Valley",
  description = "Warm, non-judgemental decluttering and home organising for Shepparton and the Goulburn Valley. Simple systems, local care, and lasting calm.",
  canonical,
} = Astro.props;
---

<!doctype html>
<html lang="en-AU">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />

    <!-- Brand typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Favicons -->
    <link
      rel="icon"
      href={`${import.meta.env.BASE_URL}images/logo.jpg`}
      type="image/jpeg"
      sizes="32x32"
    />
    <link
      rel="apple-touch-icon"
      href={`${import.meta.env.BASE_URL}images/logo_transparent.png`}
    />
    <meta name="theme-color" content="#ffffff" />

    <!-- Global CSS -->
    <link
      rel="stylesheet"
      href={`${import.meta.env.BASE_URL}styles/global.css`}
    />

    {canonical && <link rel="canonical" href={canonical} />}
    <title>{title}</title>
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="container header-inner">
        <a href="/" class="logo">
          <img
            src={`${import.meta.env.BASE_URL}images/logo_transparent.png`}
            alt="Shepparton Home Organising logo"
            class="logo-img"
          />
        </a>

        <!-- Desktop nav -->
        <nav class="nav nav-desktop">
          <a href="/" class="home-btn">Home</a>
          <div class="dropdown">
            <a href="/services" class="nav-parent">Services</a>
            <div class="dropdown-menu">
              <a href="/services/space-efficiency">Space Efficiency</a>
              <a href="/services/specialised-needs-support"
                >Specialised Needs Support</a
              >
              <a href="/services/technical-approach">Technical Approach</a>
              <a href="/services/fit-for-purpose-and-style"
                >Fit for purpose &amp; style</a
              >
              <a href="/services/share-house">Share house &amp; co-living</a>
            </div>
          </div>
          <a href="/service-areas">Service Offered</a>
          <a href="/before-after">Design Ideas</a>
          <a href="/about">About</a>
          <a class="btn" href="/contact">Book a free chat</a>
        </nav>

        <!-- Hamburger (mobile only) -->
        <button
          class="menu-toggle"
          aria-controls="mobile-nav"
          aria-expanded="false"
          aria-label="Open menu"
        >
          <span class="menu-bars" aria-hidden="true"></span>
        </button>
      </div>
    </header>

    <!-- Main -->
    <main class="site-main">
      <slot />
    </main>

    <!-- Sticky CTA (example) -->
    <a class="floating-cta" href="contact/">Book a free 15-min chat</a>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="container">
        <p>
          <strong>Based in Shepparton, VIC</strong> — proudly serving the Goulburn
          Valley and the shires of Mitchell, Murrindindi, Moira and Strathbogie.
        </p>
        <p>Respect • Simplicity • Discretion • Sustainability</p>
        <p class="small">
          © {new Date().getFullYear()} Shepparton Home Organising
        </p>
      </div>
    </footer>

    <!-- ⬇️ IMPORTANT: overlay + drawer live directly under <body>, not inside <header> -->
    <div class="mobile-overlay" data-close></div>

    <nav id="mobile-nav" class="nav-mobile" aria-hidden="true">
      <div class="mobile-header">
        <span class="mobile-title">Menu</span>
        <button class="menu-close" aria-label="Close menu" data-close>
          <span class="menu-cross" aria-hidden="true"></span>
        </button>
      </div>

      <ul class="mobile-list" role="list">
        <li class="mobile-item"><a href="/">Home</a></li>
        <li class="mobile-item has-sub">
          <button
            class="sub-toggle"
            aria-expanded="false"
            aria-controls="sub-services"
          >
            Services
          </button>
          <ul id="sub-services" class="sub-list" role="list" hidden>
            <li><a href="/services/space-efficiency">Space Efficiency</a></li>
            <li>
              <a href="/services/specialised-needs-support"
                >Specialised Needs Support</a
              >
            </li>
            <li>
              <a href="/services/technical-approach">Technical Approach</a>
            </li>
            <li>
              <a href="/services/fit-for-purpose-and-style"
                >Fit for purpose &amp; style</a
              >
            </li>
            <li>
              <a href="/services/share-house">Share house &amp; co-living</a>
            </li>
            <li class="sub-view-all">
              <a href="/services">View all services</a>
            </li>
          </ul>
        </li>
        <li class="mobile-item">
          <a href="/service-areas">Service Offered</a>
        </li>
        <li class="mobile-item"><a href="/before-after">Design Ideas</a></li>
        <li class="mobile-item"><a href="/about">About</a></li>
        <li class="mobile-item cta">
          <a class="btn" href="/contact">Book a free chat</a>
        </li>
      </ul>
    </nav>

    <!-- Header effect on scroll -->
    <script is:inline>
      const header = document.querySelector(".site-header");
      const onScroll = () =>
        header.classList.toggle("scrolled", window.scrollY > 10);
      onScroll();
      addEventListener("scroll", onScroll, { passive: true });
    </script>

    <!-- Mobile menu interactions -->
    <script is:inline>
      (function () {
        const root = document.documentElement;
        const body = document.body;
        const drawer = document.getElementById("mobile-nav");
        const openBtn = document.querySelector(".menu-toggle");
        const overlay = document.querySelector(".mobile-overlay");
        const closeBtns = document.querySelectorAll("[data-close]");
        const subToggles = drawer.querySelectorAll(".sub-toggle");
        let lastFocused;

        function openMenu() {
          lastFocused = document.activeElement;
          drawer.classList.add("open");
          overlay.classList.add("show");
          drawer.setAttribute("aria-hidden", "false");
          openBtn.setAttribute("aria-expanded", "true");
          body.style.overflow = "hidden";
          drawer.querySelector(".mobile-header .menu-close").focus();
        }

        function closeMenu() {
          drawer.classList.remove("open");
          overlay.classList.remove("show");
          drawer.setAttribute("aria-hidden", "true");
          openBtn.setAttribute("aria-expanded", "false");
          body.style.overflow = "";
          if (lastFocused) lastFocused.focus();
        }

        openBtn?.addEventListener("click", openMenu);
        closeBtns.forEach((btn) => btn.addEventListener("click", closeMenu));
        overlay?.addEventListener("click", closeMenu);
        window.addEventListener(
          "keydown",
          (e) => {
            if (e.key === "Escape" && drawer.classList.contains("open"))
              closeMenu();
          },
          { passive: true }
        );
        drawer.addEventListener("click", (e) => {
          const a = e.target.closest("a");
          if (a) closeMenu();
        });

        // Accordion
        subToggles.forEach((btn) => {
          btn.addEventListener("click", () => {
            const expanded = btn.getAttribute("aria-expanded") === "true";
            const target = document.getElementById(
              btn.getAttribute("aria-controls")
            );
            btn.setAttribute("aria-expanded", String(!expanded));
            if (expanded) {
              target.hidden = true;
              target.style.maxHeight = "";
            } else {
              target.hidden = false;
              target.style.maxHeight = target.scrollHeight + "px";
            }
          });
        });

        // Reduce-motion preference
        const mq = window.matchMedia("(prefers-reduced-motion: reduce)");
        if (mq.matches) root.classList.add("reduce-motion");
      })();
    </script>
  </body>
</html>
